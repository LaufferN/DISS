<!doctype html>
<html>
    <head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

	<title>DISS</title>

	<link rel="stylesheet" href="dist/reset.css">
	<link rel="stylesheet" href="dist/reveal.css">
	<link rel="stylesheet" href="dist/theme/black.css">
        <link rel="stylesheet" href="style.css">

	<!-- Theme used for syntax highlighted code -->
	<link rel="stylesheet" href="plugin/highlight/monokai.css">
    </head>
    <body>
	<div class="reveal">
	    <div class="slides">
		<section id="title">
                    <h1>Demonstration Informed Specification Search</h1>
                    <h2 style="opacity: 0.9">A Maximum Entropy Approach</h2>
                    <figure style="opacity: 1" data-id="1">
                        <img data-id="2" style="height: 10em;" src='imgs/episodic_learning2.svg'>
                    </figure>
 
                    <h3 style="opacity: 0.95">Marcell Vazquez-Chanlatte</h3>

                    <div style="opacity: 0.7; margin: 1em">
                    <h4 style="font-size: 0.7em;">PhD Candidate at UC Berkeley</h4>
                    <ul>

                   <li style="font-size">Slides: <a href="https://mjvc.me/DISS">mjvc.me/DISS</a></li>

                    <li style="font-size">Code: <a href="https://github.com/mvcisback/DISS">github.com/mvcisback/DISS</a></li>
                    </ul>
                    </div>

                    <footer style="font-size: 0.65em; opacity: 0.5; width: 45em; text-align: left; margin-top: 1.5em">
                        Joint work with Ameesh Shah, Gil Lederman, and Sanjit A. Seshia
                    </footer>
              </section>

                <section data-auto-animate class="structure-of-talk">
                  <h1>Structure of the talk</h1>
                  <div>
                    <h2 style="text-align: center" data-id="0">
                      Specification motivated agents
                    </h2>
                      <img style="height: 5em;" src="imgs/episodic_learning2.svg"/>
                  </div>
                  <div style="opacity: 0.1">
                    <h2 data-id="1" >From demonstrations to specifications </h2>
                  </div>
                 <div style="opacity: 0.1">
                    <h2 data-id="3"> Conclusion and future work</h2>
                  </div>
                  <div style="opacity: 0.1">
                      <h2 data-id="2">Likelihood Calculation in Symbolic MDPs </h2>
                  </div>
 
                  <footer style="font-size: 0.7em; text-align: left">
                            <cite style="opacity: 0.7; font-size: 0.85em; color: white">
                                "Learning Task Specifications from
                                Demonstrations." NeurIPS `18. 
                            </cite>
                            <br>
                            <cite style="opacity: 0.7; font-size: 0.85em; color: #70ff70">
                                "Maximum Causal Entropy
                                Specification Inference from
                                Demonstrations." CAV `20
                            </cite>
                             <br>
                            <cite style="opacity: 0.7; font-size: 0.85em; color: cyan">
                                 "Entropy Guided Control
                                Improvisation", RSS `21
 
                            </cite>
 
                  </footer>
                </section>

                <section data-auto-animate class="structure-of-talk">
                  <h1>Structure of the talk</h1>
                  <div style="opacity: 0.5">
                    <h2 style="text-align: center" data-id="0">
                      Specification motivated agents
                    </h2>
                      <img style="height: 5em;" src="imgs/episodic_learning2.svg"/>
                  </div>
                  <div>
                    <h2 data-id="1" >From demonstrations to specifications </h2>
                  </div>
                 <div style="opacity: 0.1">
                    <h2 data-id="3"> Conclusion and future work</h2>
                  </div>
                  <div style="opacity: 0.1">
                      <h2 data-id="2">Likelihood Calculation in Symbolic MDPs </h2>
                  </div>
 
                  <footer style="font-size: 0.7em; text-align: left">
                            <cite style="opacity: 0.7; font-size: 0.85em; color: white">
                                "Learning Task Specifications from
                                Demonstrations." NeurIPS `18. 
                            </cite>
                            <br> 

                            <cite style="opacity: 0.7; font-size: 0.85em; color: #e5acff">
                                "Demonstration Informed Specification Search." In progress.
                            </cite>
                  </footer>
               </section>

                <section data-auto-animate class="structure-of-talk">
                  <h1>Structure of the talk</h1>
                  <div style="opacity: 0.5">
                    <h2 style="text-align: center" data-id="0">
                      Specification motivated agents
                    </h2>
                      <img style="height: 5em;" src="imgs/episodic_learning2.svg"/>
                  </div>
                  <div style="opacity: 0.5">
                    <h2 data-id="1" >From demonstrations to specifications </h2>
                  </div>
                  <div>
                    <h2 data-id="3"> Conclusion and future work</h2>
                  </div>
 
                  <div style="opacity: 0.1">
                      <h2 data-id="2">Likelihood Calculation in Symbolic MDPs </h2>
                  </div>
 
               </section>
                <section data-auto-animate class="structure-of-talk">
                  <h1>Structure of the talk</h1>
                  <div style="opacity: 0.5">
                    <h2 style="text-align: center" data-id="0">
                      Specification motivated agents
                    </h2>
                      <img style="height: 5em;" src="imgs/episodic_learning2.svg"/>
                  </div>
                  <div style="opacity: 0.5">
                    <h2 data-id="1" >From demonstrations to specifications </h2>
                  </div>

                  <div style="opacity: 0.5">
                    <h2 data-id="3"> Conclusion and future work</h2>
                  </div>
                  <div>
                      <h2 data-id="2">Likelihood Calculation in Symbolic MDPs </h2>
                  </div>
 

                  <footer style="font-size: 0.7em; text-align: left">
                            <cite style="opacity: 0.7; font-size: 0.85em; color: yellow">
                                "A
                                Model Counter's Guide to Probabilistic
                                Systems.". (preprint)
                            </cite>

 
                            <br>
                            <cite style="opacity: 0.7; font-size: 0.85em; color: orange">

                                "Model Checking Finite-Horizon Markov
                                Chains with Probabilistic Inference",
                                CAV `21
                            </cite>

                            <br> 
                            <cite style="opacity: 0.7; font-size: 0.85em; color: #70ff70">
                                "Maximum Causal Entropy
                                Specification Inference from
                                Demonstrations." CAV `20
                            </cite>
                             <br>
                            <cite style="opacity: 0.7; font-size: 0.85em; color: cyan">
                                 "Entropy Guided Control
                                Improvisation", RSS `21
                            </cite>
 
                  </footer>
                </section>



               <section>
                   <h1>Many important domains benefit from goal inference.</h1>
                    <img data-id="3"
                         style="height: 22em;"
                         src="imgs/intent_inference_apps.svg"/>
               </section>

                <section class="communication" data-auto-animate>
                    <h1>
                        Partial Communication through actions
                    </h1>
                    <figure data-id="1">
                        <img data-id="2" style="height: 14em" class='cartoon' src='imgs/episodic_learning2.svg'>
                    </figure>
                </section>
                <section class="communication" data-auto-animat data-auto-animatee>
                    <h1 style="opacity: 0.3">
                        Partial Communication through actions
                    </h1>
                    <figure data-id="1" style="opacity: 0.1">
                        <img data-id="2" style="height: 8em" src='imgs/episodic_learning_still.svg'>
                    </figure>
                    <ol style="font-size: 1.1em; margin-top: 1em;" >
                        <li>
                            Legible actions can be incredibly diagnostic.
                            <br>
                            <cite style="opacity: 0.6; font-size: 0.7em">
                                Dragan, et al, "Legibility and predictability of robot motion." HRI `13.</cite>
                        </li>
                        <li class="fragment">Actions influence other agents.
                            <br>
                             <cite style="opacity: 0.6; font-size: 0.7em">
                           
Sadigh, et al. "Planning for autonomous cars that leverage effects on human actions." RSS `16.
                            </cite>
                        </li>

                        <li class="fragment">
                            Essential for interpreting other signals: <span style="font-size: 0.8em">(Language, Disengagments, Other agents)</span>
                            <br>
                            
                            <cite style="opacity: 0.6; font-size: 0.7em">
                                 Goodman, et al. "Pragmatic language interpretation as probabilistic inference." TiCS `16
                            </cite>
                            <br>
                             <cite style="opacity: 0.6; font-size: 0.7em">
McPherson, et al. "Modeling supervisor safe sets for improving collaboration in human-robot teams." IROS `18
                            </cite>
 
                            <br>
                             <cite style="opacity: 0.6; font-size: 0.7em">
Afolabi, et al. "People as sensors: Imputing maps from human actions." IROS `18.
                            </cite>
 
                        </li>
                    </ol>
                </section>
		<section class="motivating-question">
                    <h1>
                      Consider an agent acting in the following
                      stochastic grid world.
                    </h1>
 
                    <img data-id="3"
                         style="height: 22em;"
                         src="imgs/enter_lava_augmented_1.svg"/>
               </section>
		<section class="motivating-question">
                    <h1>
                        Can try to move up, down, left, right
                    </h1>
 
                    <img data-id="3"
                         style="height: 22em;"
                         src="imgs/enter_lava_augmented_2.svg"/>
               </section>
	
		<section data-auto-animate class="motivating-question">
                    <h1>
                        May slip due to wind
                    </h1>
 
                    <img data-id="3"
                         style="height: 22em;"
                         src="imgs/enter_lava_augmented_3.svg"/>
               </section>
	

		<section data-auto-animate class="motivating-question">
                    <h1>
                        What is the agent trying to do?
                    </h1>
 
                    <img data-id="3"
                         style="height: 22em;"
                         src="imgs/enter_lava_augmented.svg"/>
               </section>
               <section>
                    <h1>
                        Probably trying to reach <span style="color: #ffff00ff;">yellow</span> tiles
                    </h1>
 
                    <img data-id="3"
                         style="height: 22em;"
                         src="imgs/enter_lava_augmented_4.svg"/>
               </section>
 
               <section>
                    <h1>
                        Although these actions are surprising under that hypothesis
                    </h1>
 
                    <img data-id="3"
                         style="height: 22em;"
                         src="imgs/enter_lava_augmented_5.svg"/>
               </section>
               <section>
                    <h1>
                        And isn't it easier to go to this yellow tile any way?
                    </h1>
 
                    <img data-id="3"
                         style="height: 22em;"
                         src="imgs/enter_lava_augmented_6.svg"/>
               </section>
                <section class="communication" data-auto-animate>
                    <h1>
                        Goal: Systemize analysis to learn tasks
                    </h1>

                    <div style="display: flex;">
                    <img data-id="3"
                         style="height: 11em;"
                         src="imgs/enter_lava_augmented_4.svg"/>
                     <img data-id="4"
                         style="height: 11em;"
                         src="imgs/enter_lava_augmented_5.svg"/>
                     <img data-id="5"
                         style="height: 11em;"
                         src="imgs/enter_lava_augmented_6.svg"/>
 
                    </div>
               </section>

                <section>
                    <h1>Demonstration Informed Specification Search</h1>
                    <h2 class="fragment">D.I.S.S.</h2>

                    <div style="display: flex; opacity: 0.4; height: 5em" >
                    <img data-id="3"
                         style="height: 11em;"
                         src="imgs/enter_lava_augmented_4.svg"/>
                     <img data-id="4"
                         style="height: 11em;"
                         src="imgs/enter_lava_augmented_5.svg"/>
                     <img data-id="5"
                         style="height: 11em;"
                         src="imgs/enter_lava_augmented_6.svg"/>
 
                    </div>
 
                    <img style="height: 15em;" src="imgs/diss_overview3.svg"/>
                </section>

                <section class="communication" data-auto-animate>
                    <h1 >
                        Will explore inferring goals as Boolean specifications
                    </h1>

                    <figure data-id="1">
                        <img data-id="2" style="height: 12em" class='cartoon' src='imgs/episodic_learning3.svg'>
                    </figure>
 

                    <ol style="font-size: 1.3em; margin-top: 1em;">
                        <li class="fragment" style="margin-top: 0.4em; ">Support composition.</li>
                        <li class="fragment" style="margin-top: 0.4em; ">Support describing temporal tasks.</li> 
                        <li class="fragment" style="margin-top: 0.4em; ">Be semantically robust to changes in the dynamics.</li>
                    </ol>
                </section>

                <section id="running-example-revisited">
                    <h1>Support boolean compositions</h1>
                    <img src="imgs/example_domain_1.svg"/>
               </section>

                <section id="running-example-revisited">
                    <h1>Support incremental learning</h1>
                    <img src="imgs/example_domain_1_2.svg"/>
               </section>

                <section>
                    <h1>Don't need "wet" to describe dynamics</h1>
                    <img src="imgs/example_domain_1_3.svg"/>
               </section>

                <section>
                    <h1>Can learn as state machine over state colors</h1>
                    <img src="imgs/example_domain_2_1.svg"/>
               </section>

                <section>
                    <h1>Monolithic description</h1>
                    <img src="imgs/example_domain_2_2.svg"/>
               </section>

                <section>
                    <h1>Easy to express variations</h1>
                    <img src="imgs/example_domain_2_3.svg"/>
               </section>

                <section>
                    <h1>Contributions</h1>
                    <ol style="width: 70%;">
                        <li class="fragment">
                            Efficently learn finite trace properties from <strong style="color: green">unlabeled</strong> and <strong style="color: green">incomplete</strong> demonstrations in a Markov Decison
                        Process.
                            <figure style="display: flex; justify-content: space-evenly; opacity: 0.6;">

                            <img style="height: 5em" src="imgs/enter_lava_augmented.svg"/>
                            <img style="height: 5em" src="imgs/diss_overview3.svg"/>
                            <img style="height: 5em" src="imgs/experiment2.svg"/>
                            </figure>
                        </li>
                        <li class="fragment">Support <strong style="color: green">incremental</strong> and <strong style="color:green">monolithic</strong> learning.
                            <figure style="display: flex; justify-content: space-evenly; opacity: 0.6;">
                                <img style="height: 5em" src="imgs/example_domain_2_1.svg"/>
                                <img style="height: 5em" src="imgs/example_domain_2_2.svg"/>
                            </figure>
                        </li>
                        <li class="fragment">Only needs <strong style="color: green">blackbox</strong> access to a <span style="color: #f4a460">MaxEnt planner</span> and <span style="color: #ff8b8b">Concept Identifer.</span>.
                            <figure style="display: flex; justify-content: space-evenly; opacity: 0.6;">
                                <img style="height: 5em" src="imgs/diss_overview3_1.svg"/>
                                <img style="height: 5em" src="imgs/diss_overview3_2.svg"/>
                            </figure>
                        </li>
                    </ol>
               </section>

                <section data-auto-animate class="structure-of-talk">
                  <div>
                    <h2 style="text-align: center" data-id="0">
                      Specification motivated agents
                    </h2>
                      <img style="height: 5em;" src="imgs/episodic_learning3.svg"/>
                  </div>
                  <div style="opacity: 0.1">
                    <h2 data-id="1" >From demonstrations to specifications </h2>
                  </div>
                  <div style="opacity: 0.1">
                      <h2 data-id="2">Likelihood Calculation in Symbolic MDPs </h2>
                  </div>
                  <div style="opacity: 0.1">
                    <h2 data-id="3"> Conclusion and future work</h2>
                  </div>
                  <footer style="font-size: 0.7em; text-align: left">
                            <cite style="opacity: 0.7; font-size: 0.85em; color: white">
                                "Learning Task Specifications from
                                Demonstrations." NeurIPS `18. 
                            </cite>
                            <br>
                            <cite style="opacity: 0.7; font-size: 0.85em; color: #70ff70">
                                "Maximum Causal Entropy
                                Specification Inference from
                                Demonstrations." CAV `20
                            </cite>
                             <br>
                            <cite style="opacity: 0.7; font-size: 0.85em; color: cyan">
                                 "Entropy Guided Control
                                Improvisation", RSS `21
 
                            </cite>
 
                  </footer>
                </section>
                <!-- ================ Basic Definitions ============================= -->
                
                <section data-auto-animate  class="task-specs-1">
                    <!-- Formal Methods Perspective -->
                    <h1>Dynamics Model</h1>
                    <ol>                    
                        <li data-id="1">
                            <span data-id="2">Assume some fixed sets of <dfn>states</dfn> and <dfn>actions</dfn>.</span>
                            <div>
                                <img class="fragment cartoon" src="imgs/gridworld.svg"/>
                                <img class="fragment cartoon" src="imgs/mdp.svg"/>
                            </div>
                        </li>
                        <li data-id="3" class="fragment">
                            A <dfn>trace</dfn>, $\xi$, is a sequence of states and actions.
                        </li>
                        <li class="fragment">Assume maximum episode length of, \(\tau \in \mathbb{N}\).</li>
                </section>

                <section data-auto-animate class="task-specs-1">
                    <!-- Formal Methods Perspective -->
                    <h1>Trace properties</h1>
                    <ol style="height: 9em; width: 30em;">
                        <li />
                    
                            <span>A (Boolean) <strong>specification</strong>,
                            $\varphi$, is a set of traces.</span>
                            <br>
                            <div style="display: flex; justify-content: center">
                            <img style="height: 13em;" src="imgs/trace_prop2.svg"/>
                            </div>
                        </li>
                        <li class="fragment">
                            We say $\xi$ <strong>satisfies</strong> $\varphi$,
                            if $\xi \in \varphi$.
                        </li>
                        <li class="fragment">
                            A <strong>demonstration</strong> of a task
                            $\varphi$ is a possibly unlabeled and
                            incomplete example where
                            the agent <strong>tries</strong> to satisfy $\varphi$.
                        </li>
 
                    </ol>
                </section>
                <section>
                    <h1>Trace properties derived from Formal Logic, Automata, etc</h1>
                    <img style="height: 9em" src="imgs/formal_encoding.svg"/>
                    <p class="fragment">Will call a collection of trace properties a concept class.
                    </p>
                    <img class="fragment" style="height: 9em" src="imgs/concept_class.svg"/>
                </section> 


                <!-- ============= Details of specification ================= -->

                <section data-auto-animate class="requirements-overview">
                    <h1>No a-priori order on traces</h1>

                    <div>
                      <img style="height: 10em" src="imgs/compare_1.svg"/>
                    </div>

                    <h1 data-id="1" class="fragment">Agent model induces ordering.</h1>

                    <ol style="height: max-content;">
                      <li class="fragment">Need to know what moves are "risky".</li>
                      <li class="fragment">Need to know agent's objective and competency.</li>

                    </ol>

                </section>

                <!-- ================== Introduce Demonstrations ======================= -->
                <!-- LFD - NeurIPS 2018 -->
                <section class="recipe"
                         data-background-image="imgs/recipe.jpg" >
                    <img style="height: 25em;" src="imgs/inference_recipe.svg"/>
               </section>

                <section class="recipe"
                         data-background-image="imgs/recipe.jpg" >
                    <img style="height: 25em;" src="imgs/inference_recipe_1_2.svg"/>
               </section>


                <section class="irl">
                    <h1>Frame as Inverse Reinforcement Learning</h1>
                    <figure class="fragment">
                        <img style="height: 5em;" src="imgs/mdp.svg"/>
                    </figure>
                    <div class="fragment">
                        \[
                        \max_{\pi} \Big(\mathbb{E}_{s_{1:\tau}}\big(\sum_{i=1}^\tau r(s_i)~|~\pi\big)\Big)
                        \]
                    </div>
                    <div class="fragment">
                        where \[\pi(a~|~s) = \Pr(a~|~s)\]
                    </div>
                    <p style="width: 30em; text-align: left;" class=fragment>
                        Given a series of demonstrations, what reward, $r(s)$, best explains
                        the behavior? <cite style="font-size: 0.8em; opacity: 0.7">(Abbeel and Ng 2004)</cite>
                    </p>
                </section>

                <section class="irl">
                    <h1>No unique explanatory reward!</h1>
                    <div>
                        \[
                        \max_{\pi} \Big(\mathbb{E}_{s_{1:\tau}}\big(\sum_{i=1}^\tau r(s_i)~|~\pi\big)\Big)
                        \]
                    </div>
 
                   <div style="flex-direction: column; border: 1px solid #ffffff73; padding: 1em;" class="fragment">
                    <h2>
                        Maximize Causal Entropy
                    </h2>
 
                        <div data-id="3">
                        \[
                            H(A_{1:\tau}~||~S_{1:\tau}) = \sum_{t=1}^T H\Big(A_{t} \mid S_{1:t}\Big)
                        \]
                        </div>
                        <p>subject to feature statistics.</p>
                        <cite style="font-size: 0.8em; opacity: 0.7">(Ziebart, et al. 2010)</cite>
                    </div>

                </section>
                <section class="irl">
                        <h1>
                          Focus on reward matching 
                        </h1>


                    <div style="opacity: 0.2">
                        \[
                        \max_{\pi} \Big(\mathbb{E}_{s_{1:\tau}}\big(\sum_{i=1}^\tau r(s_i)~|~\pi\big)\Big)
                        \]
                    </div>
                   <div style="flex-direction: column; border: 1px solid #ffffff73; padding: 1em;">
                       <h2 style="opacity: 0.2">
                           Maximize Causal Entropy
                       </h2>
 
                        <div data-id="3" style="opacity: 0.8;">
                        \[
                            H(A_{1:\tau}~||~S_{1:\tau}) = \sum_{t=1}^T H\Big(A_{t} \mid S_{1:t}\Big)
                        \]
                        </div>
                        <p>subject to $E[r]$</p>
                    </div>

                </section>

                <section data-auto-animate class="reduction">
                  <h1 style="width: 15em;">
                    What should the reward be?
                  </h1>

                  <div class="fragment">
                    <img style="height: 8em; margin: 0;" src="imgs/compare_1.svg"/>
                  </div>

                  <h2 style="width: 15em;" class="fragment">
                    <strong>Proposal:</strong> Use indicator.
                  </h2>
                  <div class="fragment" style="font-size: 1.3em" data-id="indicator">
                    \[
                    r(\xi) \triangleq
                    \begin{cases}
                    1 & \text{if } \xi \in \varphi\\
                    0 & \text{otherwise}
                    \end{cases}
                    \]
                  </div>
                  <p class="fragment">\[E[r] = \Pr(\xi \in \varphi)\]</p>
                </section>

               <section data-auto-animate class="reduction">
                  <h1>Maximum Causal Entropy Policy</h1>
                    <div style="flex-direction: column; margin: 1em; padding: 2em:">
                        <div data-id="6">
                            \begin{equation}
                            \log\big(\pi_{\mathbf{\lambda}}(a~|~s_{1:t})\big) = Q_{\mathbf{\lambda}}(s_{1:t}, a) - V_{\mathbf{\lambda}}(s_{1:t})
                            \end{equation}
                        </div>
                        <span class="fragment" data-id="9">where </span>
                        <div class="fragment" data-id="5">
                          \[
                          V_{\mathbf{\lambda}}(s_{1:t}) \triangleq \begin{cases}
                             \ln \sum_{a} e^{Q_{\mathbf{\lambda}}(s_{1:t}, a)} & \text{if } t \neq \tau,\\
                            \lambda\cdot [s_{1:\tau} \in \varphi] & \text{otherwise}.
                          \end{cases}
                          \]
                        </div>
                        <div class="fragment" data-id="10">
                          \[
                            Q_{\mathbf{\lambda}}(s_{1:t}, a) \triangleq \mathbb{E}_{s_{1:t+1}}\left[ V_{\mathbf{\lambda}}(s_{t+1})~|~s_{1:t}, a\right]
                          \]
                        </div>
                    </div>
                    <p class="fragment">Find $\lambda$ to match $p^*$.</p>
                </section>


                <section data-auto-animate class="reduction">
                  <h1>Entropy regularized bellman backup</h1>
                    <div style="flex-direction: column; margin: 1em; padding: 2em:">
                        <div style="opacity: 0.3" data-id="6">
                            \begin{equation}
                            \log\big(\pi_{\mathbf{\lambda}}(a~|~s_{1:t})\big) = Q_{\mathbf{\lambda}}(s_{1:t}, a) - V_{\mathbf{\lambda}}(s_{1:t})
                            \end{equation}
                        </div>
                        <span style="opacity: 0.3" data-id="9">where </span>
                        <div data-id="5">
                          \[
                          V_{\mathbf{\lambda}}(s_{1:t}) \triangleq \begin{cases}
                             \ln \sum_{a} e^{Q_{\mathbf{\lambda}}(s_{1:t}, a)} & \text{if } t \neq \tau,\\
                            \lambda\cdot [s_{1:\tau} \in \varphi] & \text{otherwise}.
                          \end{cases}
                          \]
                        </div>
                        <div style="opacity: 0.3" data-id="10">
                          \[
                            Q_{\mathbf{\lambda}}(s_{1:t}, a) \triangleq \mathbb{E}_{s_{1:t+1}}\left[ V_{\mathbf{\lambda}}(s_{t+1})~|~s_{1:t}, a\right]
                          \]
                        </div>
                    </div>
                    <p>max ↦ log sum exp.</p>
                    <p class="fragment">$\mathbb{E}[r(s_{1:t})] \mapsto \mathbb{E}[r(s_{1:t})] + H(a\mid s_{1:t})$ </br>
                        <span style="opacity: 0.6">(Geist et al, ICML '19)</span>
                </p>
                </section>

                <section data-auto-animate class="reduction">
                  <h1>Entropy regularized bellman backup</h1>
                    <div style="flex-direction: column; margin: 1em; padding: 2em:">
                        <div style="opacity: 0.3" data-id="6">
                            \begin{equation}
                            \log\big(\pi_{\mathbf{\lambda}}(a~|~s_{1:t})\big) = Q_{\mathbf{\lambda}}(s_{1:t}, a) - V_{\mathbf{\lambda}}(s_{1:t})
                            \end{equation}
                        </div>
                        <span style="opacity: 0.3"  data-id="9">where </span>
                        <div  data-id="5">
                          \[
                          V_{\mathbf{\lambda}}(s_{1:t}) \triangleq \begin{cases}
                             \text{smax}_{a} Q(s_{1:t}, a) & \text{if } t \neq \tau,\\
                            \lambda\cdot [s_{1:\tau} \in \varphi] & \text{otherwise}.
                          \end{cases}
                          \]
                        </div>
                        <div style="opacity: 0.3"  data-id="10">
                          \[
                            Q_{\mathbf{\lambda}}(s_{1:t}, a) \triangleq \mathbb{E}_{s_{1:t+1}}\left[ V_{\mathbf{\lambda}}(s_{t+1})~|~s_{1:t}, a\right]
                          \]
                        </div>
                    </div>
                    <p>max ↦ smooth max (smax).</p>
                </section>
                <section data-auto-animate class="reduction">
                  <h1>Take as blackbox for now</h1>
                    <div style="flex-direction: column; margin: 1em; padding: 2em:">
                        <div style="opacity: 1" data-id="6">
                            \begin{equation}
                            \log\big(\pi_{\mathbf{\lambda}}(a~|~s_{1:t})\big) = Q_{\mathbf{\lambda}}(s_{1:t}, a) - V_{\mathbf{\lambda}}(s_{1:t})
                            \end{equation}
                        </div>
                        <span style="opacity: 0.3"  data-id="9">where </span>
                        <div  style="opacity: 0.3" data-id="5">
                          \[
                          V_{\mathbf{\lambda}}(s_{1:t}) \triangleq \begin{cases}
                             \text{smax}_{a} Q(s_{1:t}, a) & \text{if } t \neq \tau,\\
                            \lambda\cdot [s_{1:\tau} \in \varphi] & \text{otherwise}.
                          \end{cases}
                          \]
                        </div>
                        <div style="opacity: 0.3"  data-id="10">
                          \[
                            Q_{\mathbf{\lambda}}(s_{1:t}, a) \triangleq \mathbb{E}_{s_{1:t+1}}\left[ V_{\mathbf{\lambda}}(s_{t+1})~|~s_{1:t}, a\right]
                          \]
                        </div>
                    </div>
                      <img class="fragment" style="height: 5em;" src="imgs/agent_model.svg"/>
                </section>


                <section data-auto-animate class="structure-of-talk">
                  <div style="opacity: 0.5">
                    <h2 style="text-align: center" data-id="0">
                      Specification motivated agents
                    </h2>
                      <img style="height: 5em;" src="imgs/episodic_learning3.svg"/>
                  </div>
                  <div>
                    <h2 data-id="1" >From demonstrations to specifications </h2>
                  </div>
                  <div style="opacity: 0.1">
                      <h2 data-id="2">Likelihood Calculation in Symbolic MDPs </h2>
                  </div>
                  <div style="opacity: 0.1">
                    <h2 data-id="3"> Conclusion and future work</h2>
                  </div>
                </section>

                <section>
                    <h1>Demonstration Informed Specification Search</h1>
                    <img style="height: 23em;" src="imgs/diss_overview3.svg"/>
                </section>

                <section>
                    <h1>Focus on surprise guided sampler</h1>
                    <img style="height: 23em;" src="imgs/diss_overview3_1.svg"/>
                </section>

               <section class="fancyp" data-auto-animate>
                    <h1>Goal</h1>
		    <p>Want to find specification that makes the demonstrations unsurprising.</p>
		    <div class="fragment">
			    \[
				h(\varphi) \triangleq  -\sum_{i=1}^n \ln \Pr(\text{demo}_i~|~\varphi, \text{dynamics})
			    \]	
		    </div>
      
               </section>
               <section class="fancyp" data-auto-animate>
                    <h1>Three key ideas</h1>
		    <p style="opacity: 0.1">Want to find specification that makes the demonstrations unsurprising.</p>
		    <div style="opacity: 0.1">
			    \[
				h(\varphi) \triangleq  -\sum_{i=1}^n \ln \Pr(\text{demo}_i~|~\varphi, \text{dynamics})
			    \]	
		    </div>
                    <ol>
                        <li>Reframe problem as conforming or deviating from demonstrations.</li>
                        <li class="fragment">View demonstration prefix tree as computation graph.</li>
                        <li class="fragment">Can manipulate value of subtree by toggling trace labels.</li>
                    </ol>
       
               </section>



                <section class="fancyp">
                    <h1>Key idea 1: Reframe choices along demonstration</h1>
                    <figure class="fragment" data-id="1">
                        <img style="height: 7em; margin-top: 2em;" src="imgs/single_demo2.svg"/>
                    </figure>
                </section>

                <section class="fancyp">
                    <h1>Many ways to deviate from demonstration</h1>
                    <figure data-id="1">
                        <img style="height: 7em;" src="imgs/single_demo2.5.svg"/>
                    </figure>
                    <p class="fragment">Each deviation's subtree <strong>summarized</strong> by $V_\lambda, Q_\lambda$.</p>
                </section>

                <section class="fancyp">
                    <h1>Reframe as conforming or deviating</h1>
                    <figure data-id="1">
                        <img style="height: 7em;" src="imgs/single_demo2.5.svg"/>
                    </figure>
                    <p>$\mathbb{E}$ and $\text{smax}$ are <strong>associative</strong></p>
                    <div class="fragment">
                      \[
                        \begin{split}
                          \text{smax}(x, y, z) &= \ln(e^x + e^y + e^z)\\
                                        &= \ln(e^x + e^{\ln(e^y + e^z)})\\

                                        &= \text{smax}(x, \text{smax}(y, z))
                        \end{split}
                      \]
                    </div>
                    <p class="fragment">
                        So we can summarize value of "pivoting" at a given node.
                    </p>
                </section>

                <section class="fancyp" data-auto-animate>
                    <h1>Two choices along a demonstration</h1>
                    <figure data-id="1">
                        <img style="height: 6em;" src="imgs/single_demo3.svg"/>
                    </figure>
                    <figure data-id="2" class="fragment" style="border: solid; margin: 1em;">
                        <img style="height: 5em;" src="imgs/prob_deviate.svg"/>
                    </figure>
                </section>


                <section class="fancyp" >
                    <h1>Key idea 2: View demonstration as a computation tree</h1>
                    <figure class="fragment" data-id="1">
                        <img style="height: 13em; margin-top: 5em;" src="imgs/single_demo4.svg"/>
                    </figure>
                </section>

                <section class="fancyp" >
                    <h1>Environment nodes average</h1>
                    <figure data-id="1">
                        <img style="height: 13em; margin-top: 5em;" src="imgs/single_demo5.svg"/>
                    </figure>
                </section>

                <section class="fancyp" >
                    <h1>Agent nodes softmax</h1>
                    <figure data-id="1">
                        <img style="height: 13em; margin-top: 5em;" src="imgs/single_demo6.svg"/>
                    </figure>
                </section>

                <section class="fancyp">
                    <h1> Surprise <strong>factors</strong> through a function over pivot values. </h1>
                    <figure data-id="2">
                        <img style="height: 13em;" src="imgs/single_demo7.svg"/>
                    </figure>

                    <div class="fragment">
                        \[
                           \widehat{h} : \mathbb{R}^{d} \to [0, 1]
                        \]
                    </div>
                    <div class="fragment">
                        \[
                           h(\varphi) = \widehat{h}(\vec{V}_\varphi)
                        \]
                    </div>
               </section>
                <section class="fancyp">
                    <h1> Gradient of proxy surprise easy to compute.</h1>
                    <figure style="opacity: 0.3" data-id="2">
                        <img style="height: 13em;" src="imgs/single_demo7.svg"/>
                    </figure>

                   <div class="fragment">
                        \[

                       \frac{\partial \widehat{h}}{\partial V_k}(\vec{V}) =
    \sum_{\substack{(i, j) \in E\\i \text{ is ego}}} \#_{(i, j)} \cdot \bigg(\Pr(i \rightsquigarrow k\mid \vec{V}) - \Pr(j \rightsquigarrow k\mid \vec{V})\bigg)
                        \]
                    </div>
                    <p class="fragment">Key idea 3: Toggle trace labels to manipulate pivot values.</p>
               </section>

                <section class="fancyp" data-auto-animate>
                    <h1>Each pivot's subtree <strong>summarized</strong> by V</h1>
                    <figure data-id="3">
                        <img style="height: 17em;" src="imgs/single_demo8.svg"/>
                    </figure>
                </section>

                <section class="fancyp" >
                    <h1 style="width: 27em;">Each <strong>path</strong> given binary label by specification</h1>
                    <figure data-id="3">
                        <img style="height: 17em;" src="imgs/single_demo9.svg"/>
                    </figure>
                </section>

                <section class="fancyp" >
                    <h1>Flipping value <strong>monotonically</strong> changes subtree value</h1>
                    <figure data-id="3">
                        <img style="height: 17em;" src="imgs/single_demo10.svg"/>
                    </figure>

                    <div style="fragment">
                        $V_3 < V_3'$
                    </div>

                    <p style="width: 30em;" class="fragment">Can sample from <strong>$\pi$</strong> to generate high weight paths.</p>
               </section>
                <section class="fancyp" >
                    <h1>Surprise Guided Sampler</h1>
                   <ol>
                       <li style="padding: 0.3em;"; class="fragment">Fix a candidate spec and compute proxy gradient.</li>
                       <li style="padding: 0.3em;" class="fragment">Define the pivot distribution,  $D$ = softmax $\left (\frac{|\nabla \widehat{h}|}{\beta}\right)$.</li>
                       <li style="padding: 0.3em;" class="fragment">Sample a pivot, $k \sim D$ and a path, $\xi$, using the $\pi_\varphi$ such that:
                           <ol>
                               <li>$\xi$ pivots at $k$.
                               <li> $\nabla_i \widehat{h} > 0 \iff \xi \in \varphi$.</li>
                           </ol>
                        <li class="fragment">New label given by $\nabla_i \widehat{h} < 0$.</li>
                    </ol>
 
                    <img class="fragment" style="width: 80%; margin: 3em" src="imgs/sggs.svg"/>
               </section>


                <section>
                    <h1>Candidate sampler can be any exact learner</h1>
                    <img style="height: 23em;" src="imgs/diss_overview3_2.svg"/>
                </section>

                <section>
                    <h1>Lifted in simulated annealing using example buffer</h1>
                    <img style="height: 23em;" src="imgs/diss_overview3_3.svg"/>
                </section>

                <section>
                    <h1>Demonstration Informed Specification Search</h1>
                    <img style="height: 23em;" src="imgs/diss_overview3.svg"/>
                </section>

		<section class="motivating-question">
                    <h1>
                        What is the agent trying to do?
                    </h1>
 
                    <img data-id="3"
                         style="height: 22em;"
                         src="imgs/experiment.svg"/>
               </section>
               <section>
                   <h1>Quickly finds high mass probability region</h1>
 
                    <img data-id="3"
                         style="height: 22em;"
                         src="imgs/experiment2.svg"/>
 
                </section>

		<section class="motivating-question">
                    <h1>
                        Top 3 DFAs found
                    </h1>
 
                    <img data-id="3"
                         style="height: 22em;"
                         src="imgs/top3.png"/>
               </section>
 
		<section class="motivating-question">
                    <h1>
                        DISS able to find high mass probability region
                    </h1>
 
                    <img data-id="3"
                         style="height: 22em;"
                         src="imgs/experiment4.svg"/>
               </section>
 
		<section class="motivating-question">
                    <h1>
                        Top 3 DFAs found
                    </h1>
 
                    <img data-id="3"
                         style="height: 22em;"
                         src="imgs/top3_2.png"/>
               </section>
 
 
             <section>
                   <h1>In this talk</h1>
                    <figure data-id="1" style="opacity: 0.3">
                        <img data-id="2" style="height: 5em" src='imgs/episodic_learning_still.svg'>
                    </figure>
 
                    <ol style="font-size: 1em; margin-top: 1em;">
                        <li>Max (causal) entropy forecasting of specification driven agents in MDPs and Stochastic Games
                            <br>
                            <cite style="opacity: 0.7; font-size: 0.85em; color: white">
                                "Learning Task Specifications from
                                Demonstrations." NeurIPS `18. 
                            </cite>
                            <br>
                            <cite style="opacity: 0.7; font-size: 0.85em; color: #70ff70">
                                "Maximum Causal Entropy
                                Specification Inference from
                                Demonstrations." CAV `20
                            </cite>
                             <br>
                            <cite style="opacity: 0.7; font-size: 0.85em; color: cyan">
                                 "Entropy Guided Control
                                Improvisation", RSS `21
 
                            </cite>
                        </li>
                       <li style="margin-top: 1em" class="fragment">
                            Searching for likely specifications given demonstrations
                            <br>
                            <cite style="opacity: 0.7; font-size: 0.85em; color: white">
                                "Learning Task Specifications from
                                Demonstrations." NeurIPS `18. 
                            </cite>
                            <br> 

                            <cite style="opacity: 0.7; font-size: 0.85em; color: #e5acff">
                                "Demonstration Informed Specification Search." In progress.
                            </cite>
                        </li>
                    </ol> 
 
               </section>

               <section>
                   <h1>By no means solved</h1>
                    <img data-id="3"
                         style="height: 22em;"
                         src="imgs/intent_inference_apps.svg"/>
               </section>
               <section>
                   <h1>Clear path to scaling up</h1>
                    <figure data-id="3">
                        <img style="height: 10em;" src="imgs/single_demo11.svg"/>
                    </figure>

                    <ol style="font-size: 1.3em; margin-top: 1em;">
                        <li class="fragment">Need a way to estimate values.</li>
                        <li class="fragment">Need a way to sample likely paths from policy.</li>
                    </ol>
               </section>
                <section>
                    <h1>Plays nicely with approximate methods</h1>
                    <figure data-id="2" style="border: solid; margin: 1em; opacity: 0.3">
                        <img style="height: 5em;" src="imgs/prob_deviate.svg"/>
                    </figure>
 
                    <ol style="font-size: 1.1em">
                        <li style="margin-top: 0.3em; opacity: 0.3;" >Dynamic Programming</li>
                        <li style="margin-top: 0.3em; opacity: 0.3;" >Dynamic Programming on compressed structure</li>
                        <li style="margin-top: 0.3em" >Monte Carlo Tree Search <span style="font-size: 0.8em; opacity: 0.8">(e.g., Smooth Cruiser [1])</span></li>
                        <li style="margin-top: 0.3em" >Function Approximation <span style="font-size: 0.8em; opacity: 0.8">(e.g., Soft Actor Critic [2])</span></li>
                    </ol>
                    <footer style="opacity: 0.7; font-size: 0.6em; margin-top: 8em;">
                        <cite>[1] Grill, et al. "Planning in entropy-regularized Markov decision processes and games." NeurIPs`19.</cite>
                                </br>
                        <cite>
                            [2] Haarnoja, et al. "Soft actor-critic: Off-policy maximum entropy deep reinforcement learning with a stochastic actor."  PMLR, `18.
                        </cite>
                    </footer>
                </section>
                <section>
                    <h1>Natural path for combining symbolic and MCTS methods</h1>
                    <figure data-id="2" style="border: solid; margin: 1em; opacity: 0.3">
                        <img style="height: 5em;" src="imgs/prob_deviate.svg"/>
                    </figure>
 
                    <ol style="font-size: 1.1em">
                        <li style="margin-top: 0.3em; opacity: 0.3;" >Dynamic Programming</li>
                        <li style="margin-top: 0.3em;" >Dynamic Programming on compressed structure</li>
                        <li style="margin-top: 0.3em;" >Monte Carlo Tree Search <span style="font-size: 0.8em; opacity: 0.8">(e.g., Smooth Cruiser [1])</span></li>
                        <li style="margin-top: 0.3em; opacity: 0.3;" >Function Approximation <span style="font-size: 0.8em; opacity: 0.8">(e.g., Soft Actor Critic [2])</span></li>
                    </ol>
                    <footer style="opacity: 0.7; font-size: 0.6em; margin-top: 8em;">
                        <cite>[1] Grill, et al. "Planning in entropy-regularized Markov decision processes and games." NeurIPs`19.</cite>
                                </br>
                        <cite>
                            [2] Haarnoja, et al. "Soft actor-critic: Off-policy maximum entropy deep reinforcement learning with a stochastic actor."  PMLR, `18.
                        </cite>
                    </footer>
                </section>
               <section>
                   <h1>Multi-agent (inferred) assume guarantee reasoning underexplored</h1>
                   <p style="font-size: 1.3em">\[ A \implies G\]</p>
                   <img style="height: 13em" src="imgs/intent_inference_apps_2.svg"/>
                   <p class="fragment" style="font-size: 0.8em">
                       Maximum causal entropy correlated equillibria
                       seem like an interesting model
                       <br>
                       <cite style="opacity: 0.7; font-size: 0.7em">Ziebart, et al., "Maximum causal entropy correlated equilibria for Markov games." AAAI `10.</cite>
                   </p>
               </section>
		<section>

                    <h3 style="opacity: 0.95">Questions?</h3>

                    <figure style="opacity: 0.7" data-id="1">
                        <img data-id="2" style="height: 10em;" src='imgs/episodic_learning3.svg'>
                    </figure>
 



                    <footer style="margin-top: 8em; font-size: 0.5em; opacity: 0.6" >
                        <h6>A learning biased discussion of the following work</h6>
                        <ul>
                            <li>
                                Marcell Vazquez-Chanlatte, Susmit
                                Jha, Ashish Tiwari, Mark K. Ho, and
                                Sanjit A. Seshia. "Learning Task
                                Specifications from Demonstrations."
                                NeurIPS. `18. 
                            </li>
                            <li>
                                Marcell, and Sanjit
                                A. Seshia. "Maximum Causal Entropy
                                Specification Inference from
                                Demonstrations." CAV `20
                            </li>
                            <li>
                                Marcell Vazquez-Chanlatte, Markus
                                N. Rabe, and Sanjit A. Seshia. "A
                                Model Counter's Guide to Probabilistic
                                Systems.". `19
                            </li>
                            <li>
                                Marcell Vazquez-Chanlatte, Sebastian Junges,
                                Daniel J. Fremont, Sanjit
                                A. Seshia. "Entropy Guided Control
                                Improvisation", RSS `21
                            </li>
                            <li>
                                Sebastian Junges, Steven Holtzen,
                                Marcell Vazquez-Chanlatte, Todd
                                Millstein, Guy Van den Broerk, Sanjit
                                A. Seshia. "Model Checking
                                Finite-Horizon Markov Chains with
                                Probabilistic Inference", CAV `21
                            </li>
                        </ul>
                    </footer>
               </section>

            </div>
	</div>

	<script src="dist/reveal.js"></script>
	<script src="plugin/notes/notes.js"></script>
	<script src="plugin/markdown/markdown.js"></script>
	<script src="plugin/highlight/highlight.js"></script>
        <script src="plugin/math/math.js"></script>
	<script>
	 // More info about initialization & config:
	 // - https://revealjs.com/initialization/
	 // - https://revealjs.com/config/
	 Reveal.initialize({
	     hash: true,
             width: 1920,
             height: 1080,
             slideNumber: 'c',
             progress: true,
             display: 'flex',
             controls: false,
             transition: 'none',
             center: false,
	     // Learn about plugins: https://revealjs.com/plugins/
	     plugins: [ RevealMarkdown, RevealHighlight, RevealNotes, RevealMath ]
	 });
	</script>
    </body>
</html>
